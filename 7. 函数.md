## 7. 函数

在开始本节前，请确保你已经熟悉了第4章和第5章讲述的绑定函数和类的基本方法。下面我们将继续讲述普通函数、成员函数、以及Pyhton方法的知识点。

### 7.1 返回值策略

Python和C++在管理内存和对象生命周期管理上存在本质的区别。这导致我们在创建返回no-trivial类型的函数绑定时，会出现问题。仅通过类型信息，我们无法明确是Python侧需要接管返回值并最终释放资源，还是应该由C++侧来处理。因此，pybind11提供了一些返回值策略来确定由哪方管理资源，这些策略标注通过`model::def()`和`class_def()`来传递。默认策略为`return_value_policy::automatic`。

返回值策略难以捉摸，正确地选择它们则显得尤为重要。下面我们通过一个简单的例子来阐释选择错误的情形：
```c++
/* Function declaration */
Data *get_data() { return _data; /* (pointer to a static data structure) */ }
...

/* Binding code */
m.def("get_data", &get_data); // <-- KABOOM, will cause crash when called from Python
```

当Python侧调用`get_data()`方法时，返回值（原生C++类型）必须被转换为可用的Pyhton类型。